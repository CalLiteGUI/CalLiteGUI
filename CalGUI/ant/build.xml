<?xml version ="1.0" ?>
<project default="main">

	<!--taskdef name="xmltask" classname="com.oopsconsultancy.xmltask.ant.XmlTask"/-->

	<property file="build.properties" />

	<target name="main" depends="make-deploy-dir, make-jar">

		<echo>
			${message}
		</echo>

	</target>

	<target name="make-deploy-dir">


		<!--Blow away old directory if it exists-->
		<delete dir="${deploy.dir}" />

		<mkdir dir="${deploy.dir}" />

		<!--Add dirs -->
		<mkdir dir="${deploy.dir}/Config" />
		<mkdir dir="${deploy.dir}/Default" />
		<mkdir dir="${deploy.dir}/docs" />
		<mkdir dir="${deploy.dir}/jre" />
		<mkdir dir="${deploy.dir}/logs" />
		<mkdir dir="${deploy.dir}/Scenarios" />
		<mkdir dir="${deploy.dir}/Model_w2" />


		<copy todir="${deploy.dir}">

			<fileset dir="${bin.dir}" />
			<fileset dir="${lib.dir}" />

		</copy>

		<copy todir="${deploy.dir/Config}">

			<fileset dir="${config.dir}" />

		</copy>

		<copy todir="${deploy.dir/docs}">

			<fileset dir="${docs.dir}" />

		</copy>


		<copy todir="${deploy.dir/jre}">

			<fileset dir="${jre.dir}" />
		</copy>

		<copy todir="${deploy.dir/logs}">

			<fileset dir="${logs.dir}" />

		</copy>

		<copy todir="${deploy.dir/Scenarios}">

			<fileset dir="${scenario.dir}" />

		</copy>

		<copy todir="${deploy.dir/Model_w2}">

			<fileset dir="${model.dir}" />

		</copy>


	</target>

	<target name="make-jar">

		<jar destfile="${deploy.dir}/calgui.jar" basedir="${bin.dir}">

			<manifest>
				<attribute name="Manifest-Version" value="1.0" />
				<attribute name="Main-Class" value="gov.ca.water.calgui.MainMenu" />
				<attribute name="Class-Path" value="hec.jar jh.jar swixml.jar log4j-1.2.17.jar" />
				<attribute name="Sealed" value="false" />
			</manifest>

		</jar>



	</target>


	<!-- Set configuration parameters using xml replacement-->
	<!--target name="set-config">
		
        <xmltask source="${temp.dir}/WEB-INF/web.xml" dest="${temp.dir}/WEB-INF/web.xml" failWithoutMatch="true">            
        	<copy path="boolean(/:web-app/:filter[1]/:init-param[2]/:param-value)" property="domain.ip" />    
        	<replace path="/:web-app/:filter[1]/:init-param[2]/:param-value/text()" withText="${domain.ip}" if="domain.ip" />    
        </xmltask>
		
        <xmltask source="${temp.dir}/WEB-INF/classes/hibernate.cfg.xml" dest="${temp.dir}/WEB-INF/classes/hibernate.cfg.xml" failWithoutMatch="true">            
        	<replace path="/hibernate-configuration/session-factory/property[1]/text()" withText="${abhc.db.ip}" />       	
        </xmltask>
		
        <xmltask source="${temp.dir}/WEB-INF/classes/securityContext.xml" dest="${temp.dir}/WEB-INF/classes/securityContext.xml" failWithoutMatch="true">            
        	<replace path="/:beans/:bean[7]/:property[3]/@value" withText="${domain.ip}" />     	
        </xmltask>
		
		<replaceregexp file = "${temp.dir}/WEB-INF/classes/swap_datasource.properties" 
			match  = "jdbc:oracle:thin:@(.+):swap" 
			replace = "${swap.db.ip}">
		</replaceregexp>
		
		<replaceregexp file = "${temp.dir}/WEB-INF/classes/swap_datasource.properties" 
			match  = "jdbc:oracle:thin:@(.+):abhc" 
			replace = "${abhc.db.ip}">
		</replaceregexp>
					
		<echo>Found configuration files; inserted staging server parameters.</echo> 
	</target>
	
	
	<target name="delete-from-ftp">
			<ftp action="del"
				server="ftp.djws3.com" binary="true" verbose="true"
				userid="${name}" password="${password}" remotedir="/mikes">
				<fileset>
					<include name="swap.war"/>
				</fileset>
			</ftp>		
		</target>

		<target name="do-war">
			<war destfile="${war}/swap.war" update="true">
				<fileset dir="${temp.dir}" />
				<classes dir="${temp.dir}/WEB-INF/classes" />
			</war>
		</target>
		
		<target name="deploy">
			<ftp server="ftp.djws3.com" binary="true" verbose="true"
				userid="${name}" password="${password}" remotedir="/mikes">
				<fileset dir="${war}">
					<include name="swap.war"/>
				</fileset>
			</ftp>
		</target-->

</project>